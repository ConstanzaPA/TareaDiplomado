---
title: "Implicancia de Tenacibaculosis en la mortalidad de Salmón del Atlántico"
author: "Constanza Pino Ajenjo"
date: "`r Sys.Date()`"
output: 
  beamer_presentation:
    theme: Malmoe
    colortheme: seahorse
    fonttheme: professionalfonts
    includes:
      in_header: mystyle.tex
subtitle: Diplomado en Análisis de datos con R para la Acuicultura
institute: Pontificia Universidad Católica de Valparaíso
---

```{r setup, include=FALSE, comment=TRUE}
knitr::opts_chunk$set(echo = FALSE)

library(knitr)
library(ggplot2)
library(dplyr)
library(readxl)
library(tidyverse)
library(kableExtra)
library(pander)
library(DT)
library(gridExtra)

```

## Introducción

**Descripción del problema a resolver:** 
Tenacibaculosis es una infección bacteriana cuya etiología Tenacibaculum maritimus (Flexibacter maritimus) afecta principalmente al cultivo de Salmón del Atlántico. Principalmente se evidencian lesiones macroscópicas en la superficie del cuerpo; úlceras, necrosis, boca erosionada, aletas deshilachadas y cola con pudrición, y a veces necrosis en las branquias y los ojos (congestión choroidal y hemorragia sub-choroidal, a veces con ruptura del ojo). Debido a su impacto en la salud de Salmón del Atlántico, es importante analizar si los actuales tipos de dieta tienen alguna implicancia en la mortalidad por Tenacibaculosis en los centros de cultivo en agua de mar.

## Introducción

**Variables de estudio:** 
En este trabajo se observan las variables obtenidas durante los últimos cinco años en cada centro de cultivo en agua de mar:

- número de mortalidad causada por Tenacibaculosis (Mort_Tena)


**Factores a analizar:** 

- tipos de alimentos (Alimento).

**Número total de observaciones:** 

- 236 jaulas de cultivo en agua de mar (Unidad).

**Hipótesis:**

- Hipótesis nula (H0): los tipos de alimentos son iguales en la mortalidad por Tenacibaculosis.

- Hipotesis alternativa (H1): los tipos de alimentos son distintos.


## Desarrollo

```{r Preparar datos, include=FALSE, comment=FALSE}
knitr::opts_chunk$set(echo = FALSE)

#Cargar la base de datos en el objeto Tena:
Tena <- read_excel("Tenacibaculosis.xlsx", sheet=1,na="NA")
Tena <- na.omit(Tena)
head(Tena)

#Ordenar Tena creando un objeto tidy_Tena con las variables de interés:
tidy_Tena <- select(Tena,Unidad,Alimento,Ingreso,Peso_cosecha,Mortalidad,P.Mortalidad,Mort_Tena,P.Mort_Tena,Mort_BKD,P.Mort_BKD,Mort_SRS,P.Mort_SRS)
head(tidy_Tena)

#Explorar si las variables son números o carácteres:
str(tidy_Tena)

#Transformar Unidad y Alimento a factor usando as.factor, luego visualizar que Unidad y Alimento estén transformados adecuadamente a factor y que los datos están balanceados:
tidy_Tena$Unidad <- as.factor(tidy_Tena$Unidad)
tidy_Tena$Alimento <- as.factor(tidy_Tena$Alimento)
summary(tidy_Tena)
table(tidy_Tena$Unidad,tidy_Tena$Alimento)

```



```{r Gráficos exploratorios, include=FALSE, comment=FALSE}

My_Theme = theme(axis.title.x = element_text(size = 18),
  axis.text.x = element_text(size = 18),
  axis.title.y = element_text(size = 18),
  axis.text.y = element_text(size = 18))

hist_Tena <- ggplot(tidy_Tena,aes(P.Mort_Tena))+
  geom_histogram(fill="lightblue",color="black",bins=10)

blot_Tena <- ggplot(tidy_Tena,aes(y=P.Mort_Tena,x=Alimento))+
  geom_boxplot(fill="lightgreen",outlier.colour = "red")+
  labs(y="% Mort. Tenacibaculosis",x="Tipo de Alimento")

theme_classic()

```

**Frecuencia de mortalidad por Tenacibaculosis**
```{r Gráfico 1, warning=FALSE, message=FALSE, out.width = '70%', fig.align='center',fig.cap="Gráficvo1"}

hist_Tena+My_Theme

```

## Desarrollo

**Tipo de alimento vs mortalidad por Tenacibaculosis**
```{r blot, warning=FALSE, message=FALSE, out.width = '70%', fig.align='center'}
knitr::opts_chunk$set(echo = FALSE)

blot_Tena+My_Theme
```


## Desarrollo
```{r, Tabla media y varianza, warning=FALSE, message=FALSE, out.width = '70%', fig.align='center'}

Tabla1 = tidy_Tena %>% group_by(Alimento) %>%
summarize(N= n(), Mean = mean(P.Mort_Tena),
          Variance= var(P.Mort_Tena))

```


**Media y varianza de mortalidad causada por Tenacibaculosis por tipo de alimento**

```{r, Tabla 1 warning=FALSE, message=FALSE, out.width = '70%', fig.align='center'}

knitr::kable(Tabla1)
```

## Desarrollo

```{r Modelo lineal genral nulo, message=FALSE, out.width = '70%', fig.align='center'}

mod_nulo <- glm(P.Mort_Tena ~ 1,
family = binomial, data = tidy_Tena)

summary(mod_nulo)$coef %>% kable()

```

## Desarrollo

```{r Modelo lineal general 1, message=FALSE, out.width = '70%', fig.align='center'}

mod_lm1 <- glm(P.Mort_Tena ~ Alimento,
family= binomial, data = tidy_Tena)

summary(mod_lm1)$coef %>% kable()

```

## Desarrollo

```{r Comparación modelos lineales generales, message=FALSE, out.width = '70%', fig.align='center'}

AIC(mod_nulo,mod_lm1) %>% kable()

```


## Conclusión

```{r}

```

