---
title: "Evaluación de la dieta en la mortalidad del Salmón del Atlántico"
author: "Constanza Pino Ajenjo"
date: "`r Sys.Date()`"
output:
  beamer_presentation:
    theme: Malmoe
    colortheme: seahorse
    fonttheme: professionalfonts
    includes:
      in_header: mystyle.tex
      subtitle: Diplomado en Análisis de datos con R para la Acuicultura
institute: Pontificia Universidad Católica de Valparaíso
---

```{r setup, include=FALSE, comment=TRUE}
knitr::opts_chunk$set(echo = FALSE)

library(knitr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(readxl)
library(kableExtra)
library(pander)
library(DT)
library(gridExtra)
library(stats)
library(stats4)
library(car)

```


## Introducción

**Descripción del problema a resolver:** 

Completar introducción

Debido a su impacto en la salud de Salmón del Atlántico, es importante evaluar la influencia de la dieta en la mortalidad en los centros de cultivo en agua de mar.

**Objetivo:** 

Analizar si la dieta afecta la mortalidad de Salmón Atlántico en 136 jaulas (Unidad) en centros de agua mar durante los últimos 3 años.


```{r Preparar datos, include=FALSE, comment=FALSE}

#Cargar la base de datos en el objeto Dietas:
Salar <- read_excel("Salar.xlsx", sheet=1,na="NA")
Salar <- na.omit(Salar)
head(Salar)

#Explorar si las variables son números o carácteres:
str(Salar)

#Transformar Unidad y Dieta a factor usando as.factor, luego visualizar que Unidad y Dieta estén transformados adecuadamente a factor y que los datos están balanceados:
Salar$Unidad <- as.factor(Salar$Unidad)
Salar$Dieta <- as.factor(Salar$Dieta)
summary(Salar)

```


## Análisis exploratorio de los datos

**1.** **Descripción de la variación de las variables:**

1) Histogramas: las tres variables exploradas no tienen distribución normal.

```{r Histogramas,warning=FALSE, message=FALSE, out.width = '70%', fig.align='center'}
#Observar el comportamiento de las variables en estudio usando histogramas y boxplot (valor atípico se muestra en punto de color rojo):

hist_ing <- ggplot(Salar,aes(Ingreso))+
  geom_histogram(fill="lightblue",color="black",bins=10)+
  labs(title = "Número de peces ingresados")

hist_peso <- ggplot(Salar,aes(Peso_cosecha))+
  geom_histogram(fill="lightblue",color="black",bins=8)+
  labs(title = "Peso promedio de cosecha")

hist_mort <- ggplot(Salar,aes(Prop_Mort))+
  geom_histogram(fill="lightblue",color="black",bins=10)+
  labs(title = "Prop. de mortalidad")

grid.arrange(hist_ing, hist_peso, hist_mort, ncol=1, nrow =3)

```

## Análisis exploratorio de los datos

**1.** **Descripción de la variación de las variables:**

2) Boxplot de las variables por factor Unidad: 

```{r ,warning=FALSE, message=FALSE, out.width = '70%', fig.align='center'}

bi <-ggplot(data=Salar, aes(x=Unidad,y=Ingreso))+geom_boxplot()
bp <-ggplot(data=Salar, aes(x=Unidad,y=Peso_cosecha))+geom_boxplot()
bm <-ggplot(data=Salar, aes(x=Unidad,y=Prop_Mort))+geom_boxplot()

grid.arrange(bi, bp, bm, ncol=1, nrow =3)

```


## Análisis exploratorio de los datos

**1.** **Descripción de la variación de las variables:**

3) Diagrama de caja y bigotes de las variables por factor Dieta: solo difieren las medianas de la proporción de la mortalidad según el tipo de dieta

```{r Boxplot variables por tipo de Dieta ,warning=FALSE, message=FALSE, out.width = '70%', fig.align='center'}

blot_ing <- ggplot(Salar,aes(y=Ingreso,x=Dieta))+
  geom_boxplot(fill="lightblue",outlier.colour = "red")+
  labs(y="Ingreso",x="Tipo de Dieta")

blot_peso <- ggplot(Salar,aes(y=Peso_cosecha,x=Dieta))+
  geom_boxplot(fill="lightblue",outlier.colour = "red")+
  labs(y="Peso cosecha",x="Tipo de Dieta")

blot_mort <- ggplot(Salar,aes(y=Prop_Mort,x=Dieta))+
  geom_boxplot(fill="lightblue",outlier.colour = "red")+
  labs(y="Proporción de mortalidad",x="Tipo de Dieta")

grid.arrange(blot_ing, blot_peso, blot_mort, ncol=1, nrow =3)

```


## Análisis exploratorio de los datos

**2.** **Determinar la relación entre variables y factores:**

1) Gráficos de interacción:

```{r Gráficos blot interacción ,warning=FALSE, message=FALSE, out.width = '70%', fig.align='center'}
#Establecer relación entre variables cuantitativas y factores usando gráficas de correlación, boxplot, interacción o de tamaño de los efectos:

ip1 <- interaction.plot(Salar$Unidad,Salar$Dieta, Salar$Peso_cosecha,trace.label="Dieta",fun=mean, xlab="Unidad",ylab="Peso cosecha",type="b", col= c("black", "blue"),pch=c(19,17))
 
ip2 <- interaction.plot(Salar$Unidad,Salar$Dieta, Salar$Prop_Mort,trace.label="Dieta",fun=mean,xlab="Unidad",ylab="Proporción de mortalidad",type="b", col= c("black", "blue"),pch=c(19,17))

id1 <- plot.design(Salar$Peso_cosecha~Salar$Unidad*Salar$Dieta,xlab="Factores", ylab="Peso cosecha")
 
id2 <- plot.design(Salar$Prop_Mort~Salar$Unidad*Salar$Dieta,xlab="Factores", ylab="Proporción de  mortalidad")

```


## Evaluación de los supuestos

Se determinan los siguientes supuestos para los residuales de proporción de la mortalidad:

1) **Independencia de las varibales:** si se cumple (observaciones de jaulas independientes).

2) **Homocedasticidad:** no se cumple (gráfico de residuales versus ajustados en un modelo linea).

3) **Normalidad:** no se cumple (histograma y gráfico de cuantil-cuantil en un modelo lineal. 


## Hipótesis

- **Hipótesis nula (H0):** ausencia de relación entre la dieta y la proporción de la mortalidad del Salmón del Atlántico. 

- **Hipotesis alternativa (H1):** existencia de relación entre la dieta y la proporción de la mortalidad. 


## Prueba de hipótesis

1) Modelo lineal generalizado con Binomial:

**1.** **Hipotesis nula (H0):** se rechaza considerando solo el modelo nulo (distribución binomial)

**1.** **Hipotesis nula (H0):** se acepta la hipótesis alternativa, aunque se requiere de otra u otras variables predictoras además de la dieta para poder explicar la proporción de la mortalidad.


## Conclusión

- La hipotesis nula es rechazada, es decir, la dieta está asociada a la proporción de la mortalidad del Salmón del Atlántico.

- Se debe incluir otra u otras variables predictoras además de la dieta, para poder explicar la proporción de la mortalidad.



